<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurababy Media Player</title>

<style>
  body, html {
    margin: 0;
    padding: 0;
    font-family: sans-serif;
    background: #000;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  /* Player iframe */
  #playerContainer {
    flex: 1;
    background: #000;
    border-bottom: 2px solid #fff;
  }

  #playerContainer iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Controls panel */
  #controls {
    padding: 10px 20px;
    background: #111;
    max-height: 300px;
    overflow-y: auto;
  }

  .season-btn, .episode-btn {
    display: block;
    margin: 4px 0;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #fff;
    background: #222;
    color: white;
    cursor: pointer;
    text-align: left;
    transition: 0.2s;
  }

  .season-btn:hover, .episode-btn:hover {
    background: #ff00ff;
    border-color: #ff00ff;
  }

  h3 {
    margin: 10px 0 5px;
  }
</style>
</head>
<body>

<!-- Player -->
<div id="playerContainer">
  <iframe id="media-frame" src="about:blank" allowfullscreen></iframe>
</div>

<!-- Controls: seasons + episodes -->
<div id="controls">
  <h3>Seasons</h3>
  <div id="seasonsContainer"></div>
  <h3>Episodes</h3>
  <div id="episodesContainer"></div>
</div>

<script>
(async () => {
  const params = new URLSearchParams(window.location.search);
  const src = params.get("src");
  const isTV = params.get("tv"); // optional: if tv show

  const iframe = document.getElementById("media-frame");
  const seasonsContainer = document.getElementById("seasonsContainer");
  const episodesContainer = document.getElementById("episodesContainer");

  if (!src) {
    iframe.parentElement.innerHTML = "<p style='color:white;text-align:center;'>No media URL provided.</p>";
    return;
  }

  iframe.src = src;

  // ================= SHOW SEASONS & EPISODES =================
  if (isTV) {
    const showId = params.get("id"); // pass show ID via URL query
    const res = await fetch(`/api/show/${showId}`);
    const data = await res.json();

    // Load seasons
    data.seasons?.forEach(season => {
      if (season.season_number === 0) return;
      const btn = document.createElement("button");
      btn.className = "season-btn";
      btn.textContent = `Season ${season.season_number}`;
      btn.onclick = () => loadEpisodes(showId, season.season_number);
      seasonsContainer.appendChild(btn);
    });

    // Auto-load Season 1 episodes
    loadEpisodes(showId, 1);
  }

  // ================= LOAD EPISODES FUNCTION =================
  async function loadEpisodes(showId, seasonNum) {
    episodesContainer.innerHTML = "";
    const res = await fetch(`/api/show/${showId}/season/${seasonNum}`);
    const data = await res.json();

    data.episodes?.forEach(ep => {
      const btn = document.createElement("button");
      btn.className = "episode-btn";
      btn.textContent = `E${ep.episode_number}: ${ep.name}`;
      btn.onclick = () => {
        // Build CinemaOS URL for that episode
        const episodeUrl = `https://cinemaos.tech/player/tv/${showId}/${seasonNum}/${ep.episode_number}`;
        iframe.src = episodeUrl;
      };
      episodesContainer.appendChild(btn);
    });
  }
})();
</script>

</body>
</html>
